<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizar Ficha - G√™nesis RPG</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/navbar.css">
    <link rel="stylesheet" href="../css/galaxy.css">
    <link rel="stylesheet" href="../css/glassmorphism.css">

    <style>
        :root {
            --bg-0: #071025;
            /* fundo da p√°gina */
            --card-bg: rgba(255, 255, 255, 0.1);
            /* cor do fundo para o efeito de vidro */
            --accent: #667eea;
            /* cor de destaque */
            --muted: #b0b0b0;
            /* cor de texto mais suave */
            --glass-border: rgba(255, 255, 255, 0.1);
            /* borda de vidro */
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #0a0f2a 0%, #081028 100%);
            /* fundo com gradiente */
            color: #e0e0e0;
            /* cor do texto */
        }

        /* Canvas (Nebula) - Fundo em WebGL */
        canvas#nebula-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            width: 100%;
            height: 100%;
        }

        /* Container da Ficha */
        .ficha-container {
            background: var(--card-bg);
            /* fundo com efeito de vidro */
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(8px);
            /* Aplicando desfoque para o efeito de vidro */
        }

        /* Cabe√ßalho da Ficha */
        .ficha-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--accent);
            /* cor do separador */
        }

        /* Cabe√ßalho esquerdo (Nome e Ra√ßa do Personagem) */
        .ficha-header-left {
            flex: 1;
        }

        .ficha-header-left h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 700;
            color: #fff;
        }

        .ficha-header-left p {
            margin: 5px 0 0 0;
            color: var(--muted);
            font-size: 1.05em;
        }

        .ficha-header-right {
            text-align: right;
        }

        /* Bot√µes de a√ß√£o */
        .btn-group-compact {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .btn-group-compact .btn {
            padding: 10px 16px;
            font-size: 0.9em;
            font-weight: 600;
            border-radius: 6px;
            border: none;
            background: var(--accent);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-group-compact .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Conte√∫do principal */
        .ficha-main {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* Grid para a linha superior: 2 colunas (Info+Atributos | Status) */
        .ficha-top-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        /* Grid para as se√ß√µes de tempo de rea√ß√£o e reputa√ß√£o */
        .tempo-reputacao-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        /* Caixa de tempo de rea√ß√£o */
        .tempo-reacao-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .tempo-reacao-label {
            font-size: 0.85em;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .tempo-reacao-valor {
            font-size: 3em;
            color: var(--accent);
            font-weight: 700;
        }

        /* Caixa de reputa√ß√£o */
        .reputacao-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .reputacao-label {
            font-size: 0.85em;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .reputacao-valor {
            font-size: 1.2em;
            color: #ffd700;
            font-weight: 600;
        }

        /* Grid para informa√ß√µes */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Item de informa√ß√£o (ex: Ra√ßa, Classe, etc) */
        .info-item {
            background: rgba(0, 0, 0, 0.28);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--accent);
        }

        .info-item-label {
            font-size: 0.8em;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .info-item-value {
            font-size: 1.1em;
            color: #fff;
            font-weight: 600;
        }

        /* Atributos */
        .atributos-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .atributo-row {
            display: grid;
            grid-template-columns: 30px 1fr 1fr;
            gap: 10px;
            align-items: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.28);
            border-radius: 6px;
            border-left: 2px solid var(--accent);
        }

        .atributo-emoji {
            font-size: 1.2em;
            text-align: center;
        }

        .atributo-nome {
            font-size: 0.9em;
            color: var(--muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .atributo-calculo {
            font-size: 0.85em;
            color: var(--accent);
            text-align: right;
            font-weight: 600;
        }

        /* Barra de status (Vida, Mana, Estamina) */
        .status-bar {
            margin-bottom: 15px;
        }

        .status-bar-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .status-bar-label strong {
            color: #fff;
        }

        .status-bar-label span {
            color: var(--muted);
            font-size: 0.85em;
        }

        .status-bar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            height: 24px;
            overflow: hidden;
            border: 1px solid #16213e;
            position: relative;
        }

        .status-bar-fill {
            height: 100%;
            font-size: 0.75em;
            font-weight: 700;
            color: #fff;
            transition: width 0.3s ease;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-percent {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            white-space: nowrap;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
            font-size: 0.75em;
            font-weight: 700;
            color: #fff;
        }

        .status-bar-vida .status-bar-fill {
            background: linear-gradient(90deg, #ff4444, #ff6666);
        }

        .status-bar-mana .status-bar-fill {
            background: linear-gradient(90deg, #4444ff, #6666ff);
        }

        .status-bar-estamina .status-bar-fill {
            background: linear-gradient(90deg, #ffaa00, #ffcc00);
        }

        /* Aba da Ficha */
        .ficha-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #16213e;
        }

        .ficha-tab {
            background: none;
            border: none;
            color: var(--muted);
            padding: 10px 15px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9em;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .ficha-tab:hover {
            color: var(--accent);
        }

        .ficha-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        /* Navbar */
        .ficha-navbar {
            display: flex;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.28);
            border-bottom: 2px solid var(--accent);
            border-radius: 8px;
            border: 1px solid #16213e;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .ficha-navbar-btn {
            padding: 8px 16px;
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .ficha-navbar-btn:hover {
            background: var(--accent);
            color: white;
        }

        .ficha-navbar-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Conte√∫do de abas */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Habilidades */
        .habilidade-item {
            background: rgba(0, 0, 0, 0.28);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            margin-bottom: 15px;
        }

        .habilidade-item-title {
            font-size: 1em;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .habilidade-item-desc {
            font-size: 0.95em;
            color: #e0e0e0;
            line-height: 1.5;
        }

        /* Rodap√© da ficha */
        .ficha-bottom-row {
            background: rgba(0, 0, 0, 0.28);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #16213e;
        }

        /* Conte√∫do de abas com estilo padronizado */
        .tab-content {
            padding: 20px;
            background: rgba(0, 0, 0, 0.28);
            border-radius: 8px;
            border: 1px solid #16213e;
            margin-top: 10px;
            min-height: 500px;
            overflow-y: auto;
        }

        /* Input de busca padronizado */
        .search-input {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.28);
            border: 1px solid var(--accent);
            color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        /* Fichas: chips compactos para detalhes de magias/itens */
        .accordion-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 0 0 10px 0;
        }

        .stat-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid #667eea;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 0.9em;
        }

        .stat-label {
            color: var(--muted);
            font-size: 0.75em;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .stat-value {
            color: #fff;
            font-weight: 700;
        }

        .descricao-detalhe {
            color: #e0e0e0;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <!-- Navbar (estilo do index) -->
    <nav class="navbar">
        <a href="../index.html" class="logo">G√™nesis RPG</a>

        <ul class="nav-list">
            <li><a href="fichas.html" class="nav-link">Fichas</a></li>
            <li><a href="campanhas.html" class="nav-link">Campanhas</a></li>
            <li><a href="pages/" class="nav-link">Comunidade</a></li>

            <button id="logoutBtn" class="nav-btn">Sair</button>
            </li>
        </ul>
    </nav>

    <div class="container-fluid py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="ficha-container">
                    <!-- Header -->
                    <div class="ficha-header">
                        <div class="ficha-header-left">
                            <h1 id="nomePersonagemHeader">-</h1>
                            <p id="racaPersonagemHeader">-</p>
                        </div>
                        <div class="ficha-header-right">
                            <div class="btn-group-compact">
                                <button class="btn btn-info" onclick="irParaCombate()">‚öîÔ∏è Combate</button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="ficha-main">
                        <!-- Linha Superior: 2 Colunas (Info+Atributos | Status) -->
                        <div class="ficha-top-row">
                            <!-- Coluna Esquerda: Informa√ß√µes Pessoais + Atributos -->
                            <div>
                                <!-- Informa√ß√µes Pessoais -->
                                <div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div class="section-title">üë§ Informa√ß√µes Pessoais</div>
                                        <button onclick="toggleEditarInfo()"
                                            style="background: none; border: none; color: #667eea; cursor: pointer; font-size: 18px;">‚úèÔ∏è</button>
                                    </div>
                                    <div class="info-grid">
                                        <div class="info-item">
                                            <div class="info-item-label">Nome</div>
                                            <div class="info-item-value" id="nome-view">-</div>
                                            <input type="text" id="nome" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                        <div class="info-item">
                                            <div class="info-item-label">Ra√ßa</div>
                                            <div class="info-item-value" id="raca-view">-</div>
                                            <input type="text" id="raca" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                        <div class="info-item">
                                            <div class="info-item-label">Idade</div>
                                            <div class="info-item-value" id="idade-view">-</div>
                                            <input type="number" id="idade" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                        <div class="info-item">
                                            <div class="info-item-label">N√≠vel</div>
                                            <div class="info-item-value" id="nivel-view">0</div>
                                            <input type="number" id="nivel" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                        <div class="info-item">
                                            <div class="info-item-label">Altura</div>
                                            <div class="info-item-value"><span id="altura-view">-</span> cm</div>
                                            <input type="number" id="altura" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                        <div class="info-item">
                                            <div class="info-item-label">Peso</div>
                                            <div class="info-item-value"><span id="peso-view">-</span> kg</div>
                                            <input type="number" id="peso" class="info-item-input"
                                                style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                        </div>
                                    </div>
                                    <div id="info-save-btn" style="display: none; margin-top: 10px;">
                                        <button onclick="salvarInfo()"
                                            style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                                        <button onclick="cancelarEditarInfo()"
                                            style="padding: 8px 16px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
                                    </div>
                                </div>

                                <!-- Atributos -->
                                <div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div class="section-title">üåü Atributos</div>
                                        <button onclick="toggleEditarAtributos()"
                                            style="background: none; border: none; color: #667eea; cursor: pointer; font-size: 18px;">‚úèÔ∏è</button>
                                    </div>
                                    <div class="atributos-list">
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">üí™</div>
                                            <div class="atributo-nome">For√ßa</div>
                                            <div class="atributo-calculo"><span id="forcaBase-view">0</span> + <span
                                                    id="forcaBonus-view">0</span> = <strong><span
                                                        id="forcaTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="forcaBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="forcaBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span id="forcaTotal-edit">0</span></strong>
                                            </div>
                                        </div>
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">üèÉ</div>
                                            <div class="atributo-nome">Agilidade</div>
                                            <div class="atributo-calculo"><span id="agilidadeBase-view">0</span> + <span
                                                    id="agilidadeBonus-view">0</span> = <strong><span
                                                        id="agilidadeTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="agilidadeBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="agilidadeBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span id="agilidadeTotal-edit">0</span></strong>
                                            </div>
                                        </div>
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">üçÄ</div>
                                            <div class="atributo-nome">Sorte</div>
                                            <div class="atributo-calculo"><span id="sorteBase-view">0</span> + <span
                                                    id="sorteBonus-view">0</span> = <strong><span
                                                        id="sorteTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="sorteBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="sorteBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span id="sorteTotal-edit">0</span></strong>
                                            </div>
                                        </div>
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">ü§ì</div>
                                            <div class="atributo-nome">Intelig√™ncia</div>
                                            <div class="atributo-calculo"><span id="inteligenciaBase-view">0</span> +
                                                <span id="inteligenciaBonus-view">0</span> = <strong><span
                                                        id="inteligenciaTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="inteligenciaBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="inteligenciaBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span
                                                        id="inteligenciaTotal-edit">0</span></strong></div>
                                        </div>
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">üßø</div>
                                            <div class="atributo-nome">Corpo Ess√™ncia</div>
                                            <div class="atributo-calculo"><span id="corpoEssenciaBase-view">0</span> +
                                                <span id="corpoEssenciaBonus-view">0</span> = <strong><span
                                                        id="corpoEssenciaTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="corpoEssenciaBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="corpoEssenciaBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span
                                                        id="corpoEssenciaTotal-edit">0</span></strong></div>
                                        </div>
                                        <div class="atributo-row">
                                            <div class="atributo-emoji">üÄÑ</div>
                                            <div class="atributo-nome">Exposi√ß√£o R√∫nica</div>
                                            <div class="atributo-calculo"><span id="exposicaoRunicaBase-view">0</span> +
                                                <span id="exposicaoRunicaBonus-view">0</span> = <strong><span
                                                        id="exposicaoRunicaTotal">0</span></strong></div>
                                            <div class="atributo-calculo-edit" style="display: none;"><input
                                                    type="number" id="exposicaoRunicaBase"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                                + <input type="number" id="exposicaoRunicaBonus"
                                                    style="width: 40px; padding: 4px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                                                    disabled> = <strong><span
                                                        id="exposicaoRunicaTotal-edit">0</span></strong></div>
                                        </div>
                                    </div>
                                    <div id="atributos-save-btn" style="display: none; margin-top: 10px;">
                                        <button onclick="salvarAtributos()"
                                            style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                                        <button onclick="cancelarEditarAtributos()"
                                            style="padding: 8px 16px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
                                    </div>
                                </div>

                                <!-- Tempo de Rea√ß√£o e Reputa√ß√£o lado a lado -->
                                <div class="tempo-reputacao-row">
                                    <div class="tempo-reacao-box">
                                        <div class="tempo-reacao-label">‚è±Ô∏è Tempo de Rea√ß√£o</div>
                                        <div class="tempo-reacao-valor" id="tempoReacaoValor">0</div>
                                    </div>
                                    <div class="reputacao-box">
                                        <div class="reputacao-label">üéñÔ∏è Status Social <button
                                                onclick="toggleEditarReputacao()"
                                                style="background: none; border: none; color: #667eea; cursor: pointer; font-size: 14px;">‚úèÔ∏è</button>
                                        </div>
                                        <div class="reputacao-valor" id="reputacao-view">-</div>
                                        <select id="statusSocial"
                                            style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                            <option value="">Selecione...</option>
                                            <option value="Repugnante">Repugnante</option>
                                            <option value="Asqueroso">Asqueroso</option>
                                            <option value="Desprez√≠vel">Desprez√≠vel</option>
                                            <option value="Ofensivo">Ofensivo</option>
                                            <option value="Question√°vel">Question√°vel</option>
                                            <option value="Neutro">Neutro</option>
                                            <option value="Aceit√°vel">Aceit√°vel</option>
                                            <option value="Admir√°vel">Admir√°vel</option>
                                            <option value="Sublime">Sublime</option>
                                            <option value="Sagrado">Sagrado</option>
                                        </select>
                                        <div id="reputacao-save-btn" style="display: none; margin-top: 10px;">
                                            <button onclick="salvarReputacao()"
                                                style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                                            <button onclick="cancelarEditarReputacao()"
                                                style="padding: 8px 16px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Esquiva e Acerto -->
                                <div class="tempo-reputacao-row" style="margin-top: 15px;">
                                    <div class="tempo-reacao-box">
                                        <div class="tempo-reacao-label">üõ°Ô∏è Esquiva</div>
                                        <div class="tempo-reacao-valor" id="esquivaValor">0</div>
                                    </div>
                                    <div class="tempo-reacao-box">
                                        <div class="tempo-reacao-label">üéØ Acerto</div>
                                        <div class="tempo-reacao-valor" id="acertoValor">0</div>
                                    </div>
                                </div>

                                <!-- Hist√≥rico de Rolagens -->
                                <div
                                    style="margin-top: 20px; background: #0f1929; border: 1px solid #667eea; border-radius: 12px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.35);">
                                    <div class="section-title"
                                        style="margin: 0 0 10px 0; display: flex; align-items: center; gap: 8px;">
                                        <span>üìú Hist√≥rico de Rolagens</span>
                                    </div>
                                    <div style="overflow-x: auto; max-height: 260px; overflow-y: auto;">
                                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                            <thead>
                                                <tr style="background: #111c2f;">
                                                    <th
                                                        style="padding: 8px; text-align: left; color: #9fa6c3; border-bottom: 1px solid #23345d;">
                                                        Hora</th>
                                                    <th
                                                        style="padding: 8px; text-align: left; color: #9fa6c3; border-bottom: 1px solid #23345d;">
                                                        Dado</th>
                                                    <th
                                                        style="padding: 8px; text-align: left; color: #9fa6c3; border-bottom: 1px solid #23345d;">
                                                        Total</th>
                                                    <th
                                                        style="padding: 8px; text-align: left; color: #9fa6c3; border-bottom: 1px solid #23345d;">
                                                        Detalhe</th>
                                                </tr>
                                            </thead>
                                            <tbody id="diceHistoryBody">
                                                <tr>
                                                    <td colspan="4"
                                                        style="padding: 10px; text-align: center; color: #9fa6c3;">Sem
                                                        rolagens registradas ainda.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Coluna Direita: Status + Navbar -->
                            <div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div class="section-title">üîÆ Status</div>
                                    <button onclick="toggleEditarStatus()"
                                        style="background: none; border: none; color: #667eea; cursor: pointer; font-size: 18px;">‚úèÔ∏è</button>
                                </div>
                                <div class="status-bar status-bar-vida">
                                    <div class="status-bar-label">
                                        <strong>‚ù§Ô∏è Vida</strong>
                                        <span id="vida-view"><span id="vidaAtual">0</span> / <span
                                                id="vidaMaxima-view">0</span></span>
                                        <span id="vida-edit" style="display: none;"><input type="number"
                                                id="vidaAtual-edit"
                                                style="width: 40px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                            / <input type="number" id="vidaMaxima"
                                                style="width: 50px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"></span>
                                    </div>
                                    <div class="status-bar-container">
                                        <div class="status-bar-fill" id="vidaBar" style="width: 100%;"></div>
                                        <span id="vidaPercent" class="status-percent">100%</span>
                                    </div>
                                    <div
                                        style="display: flex; gap: 5px; margin-top: 8px; justify-content: flex-end; align-items: center;">
                                        <button onclick="alterarVida(-5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ‚óÄ</button>
                                        <button onclick="alterarVida(-1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ</button>
                                        <button onclick="alterarVida(1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂</button>
                                        <button onclick="alterarVida(5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂‚ñ∂</button>
                                    </div>
                                </div>

                                <div class="status-bar status-bar-mana">
                                    <div class="status-bar-label">
                                        <strong>üîµ Mana</strong>
                                        <span id="mana-view"><span id="manaAtual">0</span> / <span
                                                id="manaMaxima-view">0</span></span>
                                        <span id="mana-edit" style="display: none;"><input type="number"
                                                id="manaAtual-edit"
                                                style="width: 40px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                            / <input type="number" id="manaMaxima"
                                                style="width: 50px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"></span>
                                    </div>
                                    <div class="status-bar-container">
                                        <div class="status-bar-fill" id="manaBar" style="width: 100%;"></div>
                                        <span id="manaPercent" class="status-percent">100%</span>
                                    </div>
                                    <div
                                        style="display: flex; gap: 5px; margin-top: 8px; justify-content: flex-end; align-items: center;">
                                        <button onclick="alterarMana(-5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ‚óÄ</button>
                                        <button onclick="alterarMana(-1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ</button>
                                        <button onclick="alterarMana(1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂</button>
                                        <button onclick="alterarMana(5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂‚ñ∂</button>
                                    </div>
                                </div>

                                <div class="status-bar status-bar-estamina">
                                    <div class="status-bar-label">
                                        <strong>‚ö° Estamina</strong>
                                        <span id="estamina-view"><span id="estaminaAtual">0</span> / <span
                                                id="estaminaMaxima-view">0</span></span>
                                        <span id="estamina-edit" style="display: none;"><input type="number"
                                                id="estaminaAtual-edit"
                                                style="width: 40px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                            / <input type="number" id="estaminaMaxima"
                                                style="width: 50px; padding: 2px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"></span>
                                    </div>
                                    <div class="status-bar-container">
                                        <div class="status-bar-fill" id="estaminaBar" style="width: 100%;"></div>
                                        <span id="estaminaPercent" class="status-percent">100%</span>
                                    </div>
                                    <div
                                        style="display: flex; gap: 5px; margin-top: 8px; justify-content: flex-end; align-items: center;">
                                        <button onclick="alterarEstamina(-5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ‚óÄ</button>
                                        <button onclick="alterarEstamina(-1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚óÄ</button>
                                        <button onclick="alterarEstamina(1)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂</button>
                                        <button onclick="alterarEstamina(5)"
                                            style="background: none; border: none; color: #e0e0e0; cursor: pointer; font-size: 14px; padding: 0 3px;">‚ñ∂‚ñ∂</button>
                                    </div>
                                </div>

                                <div class="info-grid" style="margin-top: 15px;">
                                    <div class="info-item">
                                        <div class="info-item-label">Poder M√°gico</div>
                                        <div class="info-item-value" id="poderMagico-view">0</div>
                                        <input type="number" id="poderMagico"
                                            style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                    </div>
                                    <div class="info-item">
                                        <div class="info-item-label">Controle</div>
                                        <div class="info-item-value" id="controle-view">0</div>
                                        <input type="number" id="controle"
                                            style="display: none; width: 100%; padding: 6px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                                    </div>
                                </div>
                                <div id="status-save-btn" style="display: none; margin-top: 10px;">
                                    <button onclick="salvarStatus()"
                                        style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                                    <button onclick="cancelarEditarStatus()"
                                        style="padding: 8px 16px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
                                </div>

                                <!-- Navbar embaixo de Status -->
                                <div class="ficha-navbar" style="margin-top: 30px;">
                                    <button class="ficha-navbar-btn active" onclick="switchTab('magias')">ü™Ñ
                                        Magias</button>
                                    <button class="ficha-navbar-btn" onclick="switchTab('habilidades')">‚öîÔ∏è
                                        Habilidades</button>
                                    <button class="ficha-navbar-btn" onclick="switchTab('conhecimentos')">üìö
                                        Conhecimentos</button>
                                    <button class="ficha-navbar-btn" onclick="switchTab('inventario')">üéí
                                        Invent√°rio</button>
                                    <button class="ficha-navbar-btn" onclick="switchTab('passivas')">üåÄ
                                        Passivas</button>
                                    <button class="ficha-navbar-btn" onclick="switchTab('anotacoes')">üìù
                                        Anota√ß√µes</button>
                                </div>

                                <!-- Conte√∫do das abas -->
                                <div id="tab-magias" class="tab-content active">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">ü™Ñ Magias</div>
                                        <button class="btn btn-primary" onclick="abrirModalMagia()"
                                            style="background: #667eea; border: none;">+ Adicionar Magia</button>
                                    </div>
                                    <input type="text" id="busca-magias" class="search-input"
                                        placeholder="Buscar magia..." oninput="filtrarMagias()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-magias">
                                            <p style="color: #b0b0b0;">Nenhuma magia adicionada ainda.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-habilidades" class="tab-content">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">‚öîÔ∏è Habilidades</div>
                                        <button class="btn btn-primary" onclick="abrirModalHabilidade()"
                                            style="background: #667eea; border: none;">+ Adicionar Habilidade</button>
                                    </div>
                                    <input type="text" id="busca-habilidades" class="search-input"
                                        placeholder="Buscar habilidade..." oninput="filtrarHabilidades()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-habilidades">
                                            <p style="color: #b0b0b0;">Nenhuma habilidade adicionada ainda.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-conhecimentos" class="tab-content">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">üìö Conhecimentos</div>
                                        <button class="btn btn-primary" onclick="abrirModalConhecimento()"
                                            style="background: #667eea; border: none;">+ Adicionar Conhecimento</button>
                                    </div>
                                    <input type="text" id="busca-conhecimentos" class="search-input"
                                        placeholder="Buscar conhecimento..." oninput="filtrarConhecimentos()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-conhecimentos">
                                            <p style="color: #b0b0b0;">Nenhum conhecimento adicionado ainda.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-inventario" class="tab-content">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">üéí Invent√°rio</div>
                                        <button class="btn btn-primary" onclick="abrirModalItem()"
                                            style="background: #667eea; border: none;">+ Adicionar Item</button>
                                    </div>
                                    <input type="text" id="busca-itens" class="search-input"
                                        placeholder="Buscar item..." oninput="filtrarItens()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-itens">
                                            <p style="color: #b0b0b0;">Invent√°rio vazio.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-anotacoes" class="tab-content">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">üìù Anota√ß√µes</div>
                                        <button class="btn btn-primary" onclick="abrirModalAnotacao()"
                                            style="background: #667eea; border: none;">+ Adicionar Anota√ß√£o</button>
                                    </div>
                                    <input type="text" id="busca-anotacoes" class="search-input"
                                        placeholder="Buscar anota√ß√£o..." oninput="filtrarAnotacoes()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-anotacoes">
                                            <p style="color: #b0b0b0;">Nenhuma anota√ß√£o adicionada ainda.</p>
                                        </div>
                                    </div>
                                </div>
                                <div id="tab-passivas" class="tab-content">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div class="section-title" style="margin: 0;">üåÄ Passivas</div>
                                        <button class="btn btn-primary" onclick="abrirModalPassiva()"
                                            style="background: #667eea; border: none;">+ Adicionar Passiva</button>
                                    </div>
                                    <input type="text" id="busca-passivas" class="search-input"
                                        placeholder="Buscar passiva..." oninput="filtrarPassivas()">
                                    <div
                                        style="max-height: 450px; overflow-y: auto; border-radius: 8px; padding-right: 10px;">
                                        <div id="lista-passivas">
                                            <p style="color: #b0b0b0;">Nenhuma passiva adicionada ainda.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAIS -->
    <!-- Modal Magia -->
    <div id="modal-magia"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; border: 1px solid #16213e; max-height: 90vh; overflow-y: auto;">
            <h3 style="color: #667eea; margin-bottom: 20px;">ü™Ñ Adicionar Magia</h3>
            <form id="form-magia">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Nome</label>
                    <input type="text" id="magia-nome"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üé≤ Dados
                        (Dice Rolls)</label>
                    <div id="magia-dados-container"
                        style="border: 1px solid #667eea; padding: 10px; border-radius: 4px; background: #0f1929; margin-bottom: 10px;">
                        <!-- Dados din√¢micos ser√£o adicionados aqui -->
                    </div>
                    <button type="button" onclick="adicionarDadoUI('magia')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar Dado</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Efeito</label>
                    <input type="text" id="magia-efeito"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="magia-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Custo de Mana</label>
                    <input type="number" id="magia-custo-mana"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="0">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Custo de Estamina</label>
                    <input type="number" id="magia-custo-estamina"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="0">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">N√≠vel</label>
                    <input type="number" id="magia-nivel"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">‚è±Ô∏è Dura√ß√£o em Turnos
                        (opcional)</label>
                    <input type="number" id="magia-duracao-turnos"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        placeholder="Ex: 3" min="0">
                    <small style="color: #999; display: block; margin-top: 5px;">Deixe vazio se n√£o tiver dura√ß√£o
                        limitada</small>
                </div>

                <!-- Se√ß√£o de B√¥nus -->
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üéÅ
                        B√¥nus</label>
                    <div id="magia-bonus-container">
                        <!-- B√¥nus din√¢micos ser√£o adicionados aqui -->
                    </div>
                    <button type="button" onclick="adicionarBonus('magia')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar B√¥nus</button>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarMagia()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalMagia()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Habilidade -->
    <div id="modal-habilidade"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; border: 1px solid #16213e; max-height: 90vh; overflow-y: auto;">
            <h3 style="color: #667eea; margin-bottom: 20px;">‚öîÔ∏è Adicionar Habilidade</h3>
            <form id="form-habilidade">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Nome</label>
                    <input type="text" id="habilidade-nome"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üé≤ Dados
                        (Dice Rolls)</label>
                    <div id="habilidade-dados-container"
                        style="border: 1px solid #667eea; padding: 10px; border-radius: 4px; background: #0f1929; margin-bottom: 10px;">
                        <!-- Dados din√¢micos ser√£o adicionados aqui -->
                    </div>
                    <button type="button" onclick="adicionarDadoUI('habilidade')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar Dado</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Efeito</label>
                    <input type="text" id="habilidade-efeito"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="habilidade-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Custo de Mana</label>
                    <input type="number" id="habilidade-custo-mana"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="0">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Custo de Estamina</label>
                    <input type="number" id="habilidade-custo-estamina"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="0">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">N√≠vel</label>
                    <input type="number" id="habilidade-nivel"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">‚è±Ô∏è Dura√ß√£o em Turnos (opcional)</label>
                    <input type="number" id="habilidade-duracao-turnos"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        placeholder="Ex: 3" min="0">
                    <small style="color: #999; display: block; margin-top: 5px;">Deixe vazio se n√£o tiver dura√ß√£o
                        limitada</small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üéÅ B√¥nus</label>
                    <div id="habilidade-bonus-container"></div>
                    <button type="button" onclick="adicionarBonus('habilidade')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar B√¥nus</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarHabilidade()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalHabilidade()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Conhecimento -->
    <div id="modal-conhecimento"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; border: 1px solid #16213e; max-height: 90vh; overflow-y: auto;">
            <h3 style="color: #667eea; margin-bottom: 20px;">üìö Adicionar Conhecimento</h3>
            <form id="form-conhecimento">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Nome</label>
                    <input type="text" id="conhecimento-nome"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="conhecimento-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">N√≠vel</label>
                    <input type="number" id="conhecimento-nivel"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üéÅ
                        B√¥nus</label>
                    <div id="conhecimento-bonus-container"></div>
                    <button type="button" onclick="adicionarBonus('conhecimento')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar B√¥nus</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarConhecimento()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalConhecimento()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Item -->
    <div id="modal-item"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; border: 1px solid #16213e; max-height: 90vh; overflow-y: auto;">
            <h3 style="color: #667eea; margin-bottom: 20px;">üéí Adicionar Item</h3>
            <form id="form-item">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Nome do Item</label>
                    <input type="text" id="item-nome"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Quantidade</label>
                    <input type="number" id="item-quantidade"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="item-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Peso (kg)</label>
                    <input type="number" id="item-peso"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        value="0" step="0.1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üé≤ Dados
                        (Dice Rolls)</label>
                    <div id="item-dados-container"
                        style="border: 1px solid #667eea; padding: 10px; border-radius: 4px; background: #0f1929; margin-bottom: 10px;">
                        <!-- Dados din√¢micos ser√£o adicionados aqui -->
                    </div>
                    <button type="button" onclick="adicionarDadoUI('item')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar Dado</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">‚è±Ô∏è Dura√ß√£o em Turnos
                        (opcional)</label>
                    <input type="number" id="item-duracao-turnos"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        placeholder="Ex: 3" min="0">
                    <small style="color: #999; display: block; margin-top: 5px;">Deixe vazio se n√£o tiver dura√ß√£o
                        limitada</small>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üéÅ
                        B√¥nus</label>
                    <div id="item-bonus-container"></div>
                    <button type="button" onclick="adicionarBonus('item')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar B√¥nus</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarItem()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalItem()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Anota√ß√£o -->
    <div id="modal-anotacao"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; border: 1px solid #16213e;">
            <h3 style="color: #667eea; margin-bottom: 20px;">üìù Adicionar Anota√ß√£o</h3>
            <form id="form-anotacao">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">T√≠tulo</label>
                    <input type="text" id="anotacao-titulo"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="anotacao-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 120px;"></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarAnotacao()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalAnotacao()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Passiva -->
    <div id="modal-passiva"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: #1a2a4e; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; border: 1px solid #16213e; max-height: 90vh; overflow-y: auto;">
            <h3 style="color: #667eea; margin-bottom: 20px;">üåÄ Adicionar Passiva</h3>
            <form id="form-passiva">
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Nome</label>
                    <input type="text" id="passiva-nome"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;"
                        required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Categoria</label>
                    <input type="text" id="passiva-categoria"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Efeito</label>
                    <input type="text" id="passiva-efeito"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #e0e0e0; display: block; margin-bottom: 5px;">Descri√ß√£o</label>
                    <textarea id="passiva-descricao"
                        style="width: 100%; padding: 8px; background: #1a2a4e; border: 1px solid #667eea; color: #e0e0e0; border-radius: 4px; min-height: 80px;"></textarea>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #667eea; display: block; margin-bottom: 10px; font-weight: bold;">üéÅ
                        B√¥nus</label>
                    <div id="passiva-bonus-container"></div>
                    <button type="button" onclick="adicionarBonus('passiva')"
                        style="width: 100%; padding: 8px; background: #16213e; color: #667eea; border: 1px dashed #667eea; border-radius: 4px; cursor: pointer;">+
                        Adicionar B√¥nus</button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="salvarPassiva()"
                        style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                    <button type="button" onclick="fecharModalPassiva()"
                        style="flex: 1; padding: 10px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/personagens.js"></script>
    <script src="../js/ficha-items.js"></script>
    <script src="../js/ativacoes.js"></script>
    <script src="../js/dados.js"></script>
    <script src="../js/modais-itens.js"></script>
    <script src="../js/visualizar-ficha.js"></script>
    <script>
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.ficha-navbar-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');

            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // ============================================
        // FUN√á√ïES PARA ALTERAR VIDA, MANA E ESTAMINA
        // ============================================

        async function alterarVida(valor) {
            const vidaAtualEl = document.getElementById('vidaAtual');

            if (!vidaAtualEl) return;

            let vidaAtual = parseInt(vidaAtualEl.textContent) || 0;
            vidaAtual = vidaAtual + valor;

            vidaAtualEl.textContent = vidaAtual;
            atualizarBarraVida();

            // Salvar no banco de dados
            if (window.fichaId) {
                await updatePersonagem(window.fichaId, { vida_atual: vidaAtual });
            }
        }

        async function alterarMana(valor) {
            const manaAtualEl = document.getElementById('manaAtual');

            if (!manaAtualEl) return;

            let manaAtual = parseInt(manaAtualEl.textContent) || 0;
            manaAtual = manaAtual + valor;

            manaAtualEl.textContent = manaAtual;
            atualizarBarraMana();

            // Salvar no banco de dados
            if (window.fichaId) {
                await updatePersonagem(window.fichaId, { mana_atual: manaAtual });
            }
        }

        async function alterarEstamina(valor) {
            const estaminaAtualEl = document.getElementById('estaminaAtual');

            if (!estaminaAtualEl) return;

            let estaminaAtual = parseInt(estaminaAtualEl.textContent) || 0;
            estaminaAtual = estaminaAtual + valor;

            estaminaAtualEl.textContent = estaminaAtual;
            atualizarBarraEstamina();

            // Salvar no banco de dados
            if (window.fichaId) {
                await updatePersonagem(window.fichaId, { estamina_atual: estaminaAtual });
            }
        }

        function atualizarBarraVida() {
            const vidaAtual = parseInt(document.getElementById('vidaAtual').textContent) || 0;
            const vidaMaxima = parseInt(document.getElementById('vidaMaxima-view').textContent) || 1;
            const percent = Math.round((vidaAtual / vidaMaxima) * 100);

            const vidaBar = document.getElementById('vidaBar');
            const vidaPercent = document.getElementById('vidaPercent');

            if (vidaBar) vidaBar.style.width = percent + '%';
            if (vidaPercent) vidaPercent.textContent = percent + '%';
        }

        function atualizarBarraMana() {
            const manaAtual = parseInt(document.getElementById('manaAtual').textContent) || 0;
            const manaMaxima = parseInt(document.getElementById('manaMaxima-view').textContent) || 1;
            const percent = Math.round((manaAtual / manaMaxima) * 100);

            const manaBar = document.getElementById('manaBar');
            const manaPercent = document.getElementById('manaPercent');

            if (manaBar) manaBar.style.width = percent + '%';
            if (manaPercent) manaPercent.textContent = percent + '%';
        }

        function atualizarBarraEstamina() {
            const estaminaAtual = parseInt(document.getElementById('estaminaAtual').textContent) || 0;
            const estaminaMaxima = parseInt(document.getElementById('estaminaMaxima-view').textContent) || 1;
            const percent = Math.round((estaminaAtual / estaminaMaxima) * 100);

            const estaminaBar = document.getElementById('estaminaBar');
            const estaminaPercent = document.getElementById('estaminaPercent');

            if (estaminaBar) estaminaBar.style.width = percent + '%';
            if (estaminaPercent) estaminaPercent.textContent = percent + '%';
        }

        async function salvarAlteracao(campo) {
            if (!window.fichaId) return;
            const elemento = document.getElementById(campo);
            if (!elemento) return;
            const valor = elemento.value;
            const updateData = {};
            updateData[campo] = isNaN(valor) ? valor : parseInt(valor);
            await updatePersonagem(window.fichaId, updateData);
        }

        async function atualizarAtributo(atributo) {
            if (!window.fichaId) return;
            const baseEl = document.getElementById(atributo + 'Base');
            const bonusEl = document.getElementById(atributo + 'Bonus');
            const totalEl = document.getElementById(atributo + 'Total');
            if (!baseEl || !bonusEl || !totalEl) return;
            const base = parseInt(baseEl.value) || 0;
            const bonus = parseInt(bonusEl.value) || 0;
            const total = base + bonus;
            totalEl.textContent = total;
            const updateData = {};
            updateData[atributo + '_base'] = base;
            updateData[atributo + '_bonus'] = bonus;
            await updatePersonagem(window.fichaId, updateData);
            recalcularTempoReacao();
        }

        function recalcularTempoReacao() {
            const forcaTotal = parseInt(document.getElementById('forcaTotal').textContent) || 0;
            const agilidadeTotal = parseInt(document.getElementById('agilidadeTotal').textContent) || 0;
            const sorteTotal = parseInt(document.getElementById('sorteTotal').textContent) || 0;
            const inteligenciaTotal = parseInt(document.getElementById('inteligenciaTotal').textContent) || 0;
            const corpoEssenciaTotal = parseInt(document.getElementById('corpoEssenciaTotal').textContent) || 0;
            const exposicaoRunicaTotal = parseInt(document.getElementById('exposicaoRunicaTotal').textContent) || 0;
            const totalAtributos = forcaTotal + agilidadeTotal + sorteTotal + inteligenciaTotal + corpoEssenciaTotal + exposicaoRunicaTotal;
            const tempoReacao = Math.floor(totalAtributos / 10);
            console.log('Tempo de Reacao:', totalAtributos, '/', 10, '=', tempoReacao);
            const tempoReacaoEl = document.getElementById('tempoReacao');
            if (tempoReacaoEl) tempoReacaoEl.textContent = tempoReacao;

            // Recalcular Esquiva e Acerto (cada 5 em agilidade = +1)
            // Nota: Os b√¥nus v√™m do banco de dados, aqui apenas recalculamos a base
            const esquivaBase = Math.floor(agilidadeTotal / 5);
            const acertoBase = Math.floor(agilidadeTotal / 5);

            // Para ter os b√¥nus atualizados, precisar√≠amos fazer uma chamada ao servidor
            // Por enquanto, apenas atualizamos a parte de base (que depende de agilidade)
            // Os b√¥nus ser√£o atualizados quando loadFicha for chamado
            console.log('Esquiva Base:', esquivaBase, 'Acerto Base:', acertoBase);
        }

        function toggleEditarInfo() {
            const campos = ['nome', 'raca', 'idade', 'nivel', 'altura', 'peso'];
            campos.forEach(campo => {
                const view = document.getElementById(campo + '-view');
                const input = document.getElementById(campo);
                if (view && input) {
                    if (view.style.display === 'none') {
                        view.style.display = 'block';
                        input.style.display = 'none';
                    } else {
                        view.style.display = 'none';
                        input.style.display = 'block';
                        input.value = view.textContent.trim();
                    }
                }
            });
            const saveBtn = document.getElementById('info-save-btn');
            if (saveBtn) saveBtn.style.display = saveBtn.style.display === 'none' ? 'block' : 'none';
        }

        async function salvarInfo() {
            if (!window.fichaId) {
                console.log('fichaId n√£o definido');
                return;
            }
            const updateData = {
                nome: document.getElementById('nome').value,
                raca: document.getElementById('raca').value,
                idade: parseInt(document.getElementById('idade').value),
                nivel: parseInt(document.getElementById('nivel').value),
                altura: parseInt(document.getElementById('altura').value),
                peso: parseInt(document.getElementById('peso').value)
            };
            console.log('Salvando info:', updateData);
            const result = await updatePersonagem(window.fichaId, updateData);
            console.log('Resultado:', result);
            if (result.success) {
                const campos = ['nome', 'raca', 'idade', 'nivel', 'altura', 'peso'];
                campos.forEach(campo => {
                    const view = document.getElementById(campo + '-view');
                    const input = document.getElementById(campo);
                    if (view && input) {
                        view.textContent = input.value;
                        view.style.display = 'block';
                        input.style.display = 'none';
                    }
                });
                document.getElementById('info-save-btn').style.display = 'none';
            } else {
                console.error('Erro ao salvar info:', result.error);
            }
        }

        function cancelarEditarInfo() {
            const campos = ['nome', 'raca', 'idade', 'nivel', 'altura', 'peso'];
            campos.forEach(campo => {
                const view = document.getElementById(campo + '-view');
                const input = document.getElementById(campo);
                if (view && input) {
                    view.style.display = 'block';
                    input.style.display = 'none';
                }
            });
            document.getElementById('info-save-btn').style.display = 'none';
        }

        function toggleEditarAtributos() {
            const viewCalcs = document.querySelectorAll('.atributo-calculo');
            const editCalcs = document.querySelectorAll('.atributo-calculo-edit');
            viewCalcs.forEach(el => {
                if (el.style.display === 'none') {
                    el.style.display = 'block';
                } else {
                    el.style.display = 'none';
                }
            });
            editCalcs.forEach(el => {
                if (el.style.display === 'none') {
                    el.style.display = 'block';
                } else {
                    el.style.display = 'none';
                }
            });
            const saveBtn = document.getElementById('atributos-save-btn');
            if (saveBtn) saveBtn.style.display = saveBtn.style.display === 'none' ? 'block' : 'none';
        }

        async function salvarAtributos() {
            if (!window.fichaId) {
                console.log('fichaId n√£o definido');
                return;
            }
            const atributos = [
                { nome: 'forca', campo: 'forca' },
                { nome: 'agilidade', campo: 'agilidade' },
                { nome: 'sorte', campo: 'sorte' },
                { nome: 'inteligencia', campo: 'inteligencia' },
                { nome: 'corpoEssencia', campo: 'corpo_essencia' },
                { nome: 'exposicaoRunica', campo: 'exposicao_runica' }
            ];
            const updateData = {};
            atributos.forEach(attr => {
                const base = parseInt(document.getElementById(attr.nome + 'Base').value) || 0;
                // Os b√¥nus s√£o calculados automaticamente e n√£o devem ser salvos manualmente
                updateData[attr.campo + '_base'] = base;
                document.getElementById(attr.nome + 'Base-view').textContent = base;
                // Recalcular o total (base + bonus que j√° est√° armazenado)
                const bonus = parseInt(document.getElementById(attr.nome + 'Bonus').value) || 0;
                document.getElementById(attr.nome + 'Bonus-view').textContent = bonus;
                document.getElementById(attr.nome + 'Total').textContent = base + bonus;
            });
            console.log('Salvando atributos:', updateData);
            const result = await updatePersonagem(window.fichaId, updateData);
            console.log('Resultado:', result);
            if (result.success) {
                toggleEditarAtributos();
                recalcularTempoReacao();
            } else {
                console.error('Erro ao salvar atributos:', result.error);
            }
        }

        function cancelarEditarAtributos() {
            toggleEditarAtributos();
        }

        function toggleEditarStatus() {
            const vidaView = document.getElementById('vida-view');
            const vidaEdit = document.getElementById('vida-edit');
            const manaView = document.getElementById('mana-view');
            const manaEdit = document.getElementById('mana-edit');
            const estaminaView = document.getElementById('estamina-view');
            const estaminaEdit = document.getElementById('estamina-edit');
            const poderMagicoView = document.getElementById('poderMagico-view');
            const poderMagicoInput = document.getElementById('poderMagico');
            const controleView = document.getElementById('controle-view');
            const controleInput = document.getElementById('controle');
            const saveBtn = document.getElementById('status-save-btn');

            if (vidaView && vidaEdit) {
                if (vidaView.style.display === 'none') {
                    // Entrando em modo de edi√ß√£o - copiar valores
                    const vidaAtualInput = document.getElementById('vidaAtual-edit');
                    if (vidaAtualInput) vidaAtualInput.value = document.getElementById('vidaAtual').textContent;
                }
                vidaView.style.display = vidaView.style.display === 'none' ? 'inline' : 'none';
                vidaEdit.style.display = vidaEdit.style.display === 'none' ? 'inline' : 'none';
            }
            if (manaView && manaEdit) {
                if (manaView.style.display === 'none') {
                    // Entrando em modo de edi√ß√£o - copiar valores
                    const manaAtualInput = document.getElementById('manaAtual-edit');
                    if (manaAtualInput) manaAtualInput.value = document.getElementById('manaAtual').textContent;
                }
                manaView.style.display = manaView.style.display === 'none' ? 'inline' : 'none';
                manaEdit.style.display = manaEdit.style.display === 'none' ? 'inline' : 'none';
            }
            if (estaminaView && estaminaEdit) {
                if (estaminaView.style.display === 'none') {
                    // Entrando em modo de edi√ß√£o - copiar valores
                    const estaminaAtualInput = document.getElementById('estaminaAtual-edit');
                    if (estaminaAtualInput) estaminaAtualInput.value = document.getElementById('estaminaAtual').textContent;
                }
                estaminaView.style.display = estaminaView.style.display === 'none' ? 'inline' : 'none';
                estaminaEdit.style.display = estaminaEdit.style.display === 'none' ? 'inline' : 'none';
            }
            if (poderMagicoView && poderMagicoInput) {
                if (poderMagicoView.style.display === 'none') {
                    poderMagicoView.style.display = 'block';
                    poderMagicoInput.style.display = 'none';
                } else {
                    poderMagicoView.style.display = 'none';
                    poderMagicoInput.style.display = 'block';
                    poderMagicoInput.value = poderMagicoView.textContent;
                }
            }
            if (controleView && controleInput) {
                if (controleView.style.display === 'none') {
                    controleView.style.display = 'block';
                    controleInput.style.display = 'none';
                } else {
                    controleView.style.display = 'none';
                    controleInput.style.display = 'block';
                    controleInput.value = controleView.textContent;
                }
            }
            if (saveBtn) saveBtn.style.display = saveBtn.style.display === 'none' ? 'block' : 'none';
        }

        async function salvarStatus() {
            if (!window.fichaId) {
                console.log('fichaId n√£o definido');
                return;
            }
            const vidaMaxima = parseInt(document.getElementById('vidaMaxima').value);
            const manaMaxima = parseInt(document.getElementById('manaMaxima').value);
            const estaminaMaxima = parseInt(document.getElementById('estaminaMaxima').value);
            const poderMagico = parseInt(document.getElementById('poderMagico').value);
            const controle = parseInt(document.getElementById('controle').value);

            const updateData = {
                vida_maxima: vidaMaxima,
                mana_maxima: manaMaxima,
                estamina_maxima: estaminaMaxima,
                poder_magico: poderMagico,
                controle: controle
            };

            console.log('Salvando status:', updateData);
            const result = await updatePersonagem(window.fichaId, updateData);
            console.log('Resultado:', result);

            if (result.success) {
                toggleEditarStatus();
                // Recarregar os dados da ficha para garantir que tudo est√° correto
                await loadFicha();
            } else {
                console.error('Erro ao salvar status:', result.error);
            }
        }

        function cancelarEditarStatus() {
            toggleEditarStatus();
        }

        // Inicializa exibi√ß√£o da navbar (mostra s√≥ bot√£o Sair quando logado)
        (async function initNavbarAuth() {
            const loginItemEl = document.getElementById('loginItem');
            const userItemEl = document.getElementById('userItem');
            const userEmailEl = document.getElementById('userEmail');
            const logoutBtnEl = document.getElementById('logoutBtn');

            function showLogged() {
                if (loginItemEl) loginItemEl.style.display = 'none';
                if (userItemEl) userItemEl.style.display = 'flex';
                if (userEmailEl) { userEmailEl.textContent = ''; userEmailEl.style.display = 'none'; }
                if (logoutBtnEl) logoutBtnEl.style.display = 'inline-block';
            }

            function showLoggedOut() {
                if (loginItemEl) loginItemEl.style.display = 'flex';
                if (userItemEl) userItemEl.style.display = 'none';
                if (logoutBtnEl) logoutBtnEl.style.display = 'none';
                if (userEmailEl) { userEmailEl.textContent = ''; userEmailEl.style.display = 'none'; }
            }

            try {
                if (typeof supabase !== 'undefined' && supabase.auth) {
                    const { data } = await supabase.auth.getUser();
                    if (data?.user) showLogged(); else showLoggedOut();
                    supabase.auth.onAuthStateChange((event, session) => {
                        if (session?.user) showLogged(); else showLoggedOut();
                    });
                } else if (typeof client !== 'undefined' && client.auth) {
                    const { data } = await client.auth.getUser();
                    if (data?.user) showLogged(); else showLoggedOut();
                    client.auth.onAuthStateChange((event, session) => {
                        if (session?.user) showLogged(); else showLoggedOut();
                    });
                }
            } catch (err) {
                console.warn('Navbar auth init failed:', err);
            }
        })();
    </script>
</body>

</html>